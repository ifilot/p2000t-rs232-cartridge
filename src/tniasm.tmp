D:\PROGRAMMING\Z80\p2000t-rs232-bootloader\src\ollie.asm124BasicProgStart: EQU $65475ProgramBlocks: EQU $9f4f 6ProgramLength: EQU $9f34 8 org $4f001011read_byte:12 push bc 13check_start_bit:14 in a,($20) 15 and $01 16 jr nz, check_start_bit 17 ld b, $15 18delay_on_start_bit:19 djnz delay_on_start_bit 20 ld b, $08 22read_next_bit:23 in a,($20) 25 29 32 35 rra 36 rr c 37 push bc 38 ld b, $10 39delay_bit:40 djnz delay_bit 41 pop bc 42 djnz read_next_bit 44 49 ld a,c 50 pop bc 51 ret 53read_program: 54 di 56read_header: 57 ld b,0 58 ld hl, $9f00 59read_header_loop:60 call read_byte 61 ld (hl),a 62 inc hl 63 djnz read_header_loop 65 66 ld hl, ProgramBlocks 67 ld c, (hl) 68 ld hl, BasicProgStart 69 jr read_block 70ignore_header:71 ld b, $00 72ignore_header_loop:73 call read_byte 74 djnz ignore_header_loop 75read_block:76 ld de, $400 77read_block_loop:78 call read_byte 79 ld (hl),a 80 inc hl 81 dec de 82 ld a,d 83 or e 84 jr nz, read_block_loop 85 dec c 86 jr nz, ignore_header 88 ld de, BasicProgStart 89 ld hl, (ProgramLength) 90 add hl,de 91 ld ($6405), hl 92 ld ($6407), hl 93 ld ($6409), hl 95 96 ld a, ($63b9) 97 add a, 2 98 ld ($63b9), a 99 ld ($6259), a 101 102 ld a,$07 103 call $104a 105 ei 106 ret 